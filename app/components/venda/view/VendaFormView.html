<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- FormulÃ¡rio Modal -->
<div class="modal-content" ng-controller="VendaController">
    
    <!-- CabeÃ§alho -->
    <div class="modal-header background">
        <button type="button" class="close" ng-click="cancel()" aria-hidden="true">
            <span class="glyphicon glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
        </button>
        <h4 class="modal-title" id="myModalLabel">
            <span class="" aria-label="Left Align">
                <!--<span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
                &nbsp;Novo Cliente <pre>{{customer | json}}</pre>-->
                <!--<pre>{{ComVenda | json}}</pre>-->
                {{ title }}
            </span>
            <span>
                {{ getId() }}
            </span>

        </h4>
    </div>
    
    <!-- FormulÃ¡rio Corpo -->
    <div class="modal-body">
        
        <div class="md-whiteframe-z0 bg-white">
            <ul class="nav nav-md nav-tabs nav-lines b-info">
                <li class="active">
                    <a href="" data-toggle="tab" data-target="#tab_1">Info</a>
                </li>
                <li>
                    <a href="" data-toggle="tab" data-target="#tab_2">Financeiro</a>
                </li>
                <li>
                    <a href="" data-toggle="tab" data-target="#tab_3">Fiscal</a>
                </li>
            </ul>
            <div class="tab-content p m-b-md b-t b-t-2x mb0">
                <div role="tabpanel" class="tab-pane animated fadeIn active" id="tab_1">
                    
                    <form id="ComVenda" name="ComVenda" ng-submit="update()">
                        
                        <fieldset>
                            <legend>Dados da Venda</legend>
                            <div class="row">
                                <div class="col-sm-12 col-lg-6">
                                    <div class="md-form-group float-label form-group">
                                        <label for="codigo">Cliente</label>
                                        
                                        <!--<select
                                            required
                                            pattern="[A-Za-z]{2,}"
                                            ng-model="formObject.CadCliente"
                                            ng-options="item.xNome for item in CadCliente.result track by item.xNome"
                                            class="form-control">
                                        </select>
                                        {{ formObject.CadCliente  }}-->
                                        
                                        <angucomplete-alt id="CadCliente" name="CadCliente"
                                            placeholder="Buscar cliente"
                                            pause="400"
                                            selected-object="setCadCliente"
                                            initial-value="formObject.CadCliente"
                                            remote-url="../public/cliente?keywords="
                                            remote-url-data-field="result"
                                            title-field="xNome, PK_cliente"
                                            description-field="xFant"
                                            field-required="true"
                                            match-class="highlight"
                                            input-class="md-input ng-pristine ng-untouched ng-valid"/>
                              
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <!--<div class="form-group">
                                        <label>Data de Abertura:</label>
                                        <pre>{{ formObject.dhabertura.date  | datetime }}</pre>
                                    </div>-->
                                    <div class="md-form-group float-label">
                                        <label>Data de Abertura</label>
                                        <input ng-model="formObject.dhabertura.date" format="datetime" disabled class="md-input ng-pristine ng-untouched ng-valid" type="text" />
                                    </div>
                                </div>
                                <div class="col-sm-6 col-lg-3">
                                    <!--<div class="form-group">
                                        <label>Data de Finalização:</label>
                                        <pre>{{ formObject.dhfinalizacao.date  | datetime }}</pre>
                                    </div>-->
                                    <div class="md-form-group float-label">
                                        <label>Data de Finalização</label>
                                        <input ng-model="formObject.dhfinalizacao.date" format="datetime" disabled class="md-input ng-pristine ng-untouched ng-valid" type="text" />
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        
                    </form>
                    
                    <form id="ComVendaItem" name="ComVendaItem">
                        <fieldset ng-controller="VendaItemController">

                            <legend>Produtos</legend>

                            <div class="row">
                                <!--<pre>{{VendaItem | json}}</pre>-->
                                <div class="col-sm-12 col-lg-8">
                                    <div class="md-form-group float-label">
                                        <label for="codigo">Produto</label>
                                        <!--
                                        <select
                                            required
                                            pattern="[A-Za-z]{2,}"
                                            ng-model="formObject.EstItem" 
                                            ng-options="item.xProd for item in EstItem.result track by item.xProd"
                                            required="number"
                                            class="form-control">
                                        </select>-->

                                        <angucomplete-alt id="EstItem" name="EstItem"
                                            placeholder="Buscar produto"
                                            pause="400"
                                            selected-object="setEstItem"
                                            initial-value="formObject.EstItem"
                                            remote-url="../public/estoque?keywords="
                                            remote-url-data-field="result"
                                            title-field="xProd, quantidade"
                                            description-field="quantidade"
                                            field-required="true"
                                            match-class="highlight"
                                            input-class="md-input ng-pristine ng-untouched ng-valid"/>
                                    </div>
                                </div>
                                
                                <div class="col-sm-6 col-lg-2">
                                    <div class="md-form-group float-label">
                                        <label>Quantidade</label>
                                        <input type="number" step="any" required  ng-model="formObject.qtrib" class="md-input" />
                                    </div>
                                </div>

                                <div class="col-sm-6 col-lg-2">
                                    <div class="md-form-group float-label">
                                        <label>Valor</label>
                                        <input type="text" format="currency" ng-model="formObject.vuntrib" class="md-input" />

                                    </div>
                                </div>
                                <!--<pre>{{formObject.vuntrib}}</pre>-->
                            </div>

                            <div class="row">
                                <div class="col-lg-1">
                                    <button ng-disabled="ComVendaItem.$invalid" ng-click="update()" class="btn btn-info">
                                        <span class="glyphicon glyphicon-floppy-disk"></span> Salvar Item
                                    </button>
                                </div>
                            </div>

                            <div class="row" style="margin-top: 10px">
                                <div class="col-sm-12 col-lg-12">
                                    <div class="table-responsive">
                                        <table ng-table="VendaItemList" class="table table-striped ng-table-responsive dataTable">
                                            <tr ng-repeat="item in $data">
                                                <td data-title="'Código'">{{item.EstItem.PK_item}}</td>
                                                <td width="750" data-title="'Descrição'"><a ng-click="show(item.pkVendaItem)">{{item.EstItem.xProd}}</a></td>
                                                <td data-title="'Qtde'">{{item.qtrib | cmddec }}</td>
                                                <td data-title="'Preço'">{{item.vuntrib | cmdcur : ""}}</td>
                                                <td data-title="'Total'">{{(item.vuntrib * item.qtrib).toFixed(2) | cmdcur : ""}}</td>
                                                <td width="20">
                                                    <button ng-click="remove(item.pkVendaItem)" class="btn btn-xs btn-default" type="button" tabindex="0">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td><b>{{getTotal($data, 'qtrib') | cmddec }}</b></td>
                                                <td></td>
                                                <td><b>{{getTotal($data, 'vuntrib', 'qtrib') | cmdcur : ""}}</b></td>
                                                <td></td>
                                            </tr>
                                    </table>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                    
                </div>
                <div role="tabpanel" class="tab-pane animated fadeIn" id="tab_2">
                    Lançamento de contas a pagar, ref a esta compra
                </div>
                <div role="tabpanel" class="tab-pane animated fadeIn" id="tab_3">
                    Importação de arquivo XML para venda automática
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Modal Footer -->
    <div class="modal-footer">
        {{ ComVenda.$invalid }}
        <button ng-disabled="ComVenda.$invalid" form="ComVenda" type="submit" class="btn btn-success pull-left">
            <span class="glyphicon glyphicon-floppy-disk"></span> Salvar
        </button>
        <button ng-disabled="formObject.dhfinalizacao.date" ng-click="finalizaVenda()" type="button" class="btn btn-primary pull-left">
            <span class="glyphicon glyphicon-ok"></span> Finalizar
        </button>
        <button ng-disabled="(formObject.dhcancelamento.date!==null)?true:false" ng-click="cancelaVenda()" type="button" class="btn btn-danger pull-left">
            <span class="mdi-navigation-cancel"></span> Cancelar
        </button>
        <button ng-click="cancel()" type="button" class="btn btn-default pull-left">
            <span class="glyphicon glyphicon-eye-close"></span> Fechar
        </button>
    </div>

</div>